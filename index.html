<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Tajib Lite â€” Enhanced Messaging</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* { 
  box-sizing: border-box; 
  margin: 0;
  padding: 0;
}
body {
  font-family: 'Inter', sans-serif; 
  background: #f5f6fa;
  height: 100vh; 
  display: flex; 
  flex-direction: column;
  transition: background-color 0.3s ease, color 0.3s ease;
}
body.dark-theme {
  background: #1a1a1a;
  color: #f0f0f0;
}
.hidden { 
  display: none !important; 
}

/* Auth Screen */
#auth {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 20px;
}

.auth-container {
  background: white;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 400px;
  padding: 30px;
  text-align: center;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.auth-container:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}
.dark-theme .auth-container {
  background: #2d2d2d;
  color: #f0f0f0;
}

.auth-header {
  margin-bottom: 25px;
}

.auth-header h2 {
  margin: 0 0 8px 0;
  font-size: 24px;
  font-weight: 700;
  color: #333;
}
.dark-theme .auth-header h2 {
  color: #f0f0f0;
}

.auth-header p {
  margin: 0;
  color: #666;
  font-size: 14px;
}
.dark-theme .auth-header p {
  color: #ccc;
}

.auth-form input {
  width: 100%;
  padding: 14px 16px;
  margin-bottom: 16px;
  border: 1px solid #ddd;
  border-radius: 12px;
  font-size: 15px;
  font-family: 'Inter', sans-serif;
  transition: all 0.2s ease;
  outline: none;
}
.dark-theme .auth-form input {
  background: #3d3d3d;
  border-color: #555;
  color: #f0f0f0;
}

.auth-form input:focus {
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.auth-form button {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  margin-top: 8px;
}

.auth-form button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
}

.auth-toggle {
  margin-top: 20px;
  font-size: 14px;
  color: #666;
}
.dark-theme .auth-toggle {
  color: #ccc;
}

.auth-toggle a {
  color: #667eea;
  text-decoration: none;
  font-weight: 500;
  cursor: pointer;
}

/* Layout */
#app {
  flex: 1; 
  display: flex; 
  height: 100%;
  opacity: 0;
  animation: fadeIn 0.5s ease forwards;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.sidebar {
  width: 280px; 
  background: #fff; 
  border-right: 1px solid #ddd;
  display: flex; 
  flex-direction: column;
  transition: all 0.3s ease;
}
.dark-theme .sidebar {
  background: #2d2d2d;
  border-color: #444;
}

.sidebar-header {
  padding: 15px; 
  display: flex; 
  justify-content: space-between; 
  align-items: center;
  border-bottom: 1px solid #ddd;
}
.dark-theme .sidebar-header {
  border-color: #444;
}

.sidebar-header h2 { 
  margin: 0; 
  font-size: 18px; 
}
.dark-theme .sidebar-header h2 {
  color: #f0f0f0;
}

.contacts {
  flex: 1; 
  overflow-y: auto;
}
.contact {
  display: flex; 
  align-items: center; 
  padding: 10px; 
  cursor: pointer;
  border-bottom: 1px solid #f0f0f0; 
  position: relative;
  transition: background-color 0.2s ease;
}
.dark-theme .contact {
  border-color: #444;
}

.contact:hover { 
  background: #f9f9f9; 
}
.dark-theme .contact:hover { 
  background: #3d3d3d; 
}

.contact img {
  width: 40px; 
  height: 40px; 
  border-radius: 50%; 
  margin-right: 10px; 
  object-fit: cover;
  transition: transform 0.2s ease;
}
.contact:hover img {
  transform: scale(1.1);
}

.contact-info { 
  flex: 1; 
  overflow: hidden;
}
.contact-info .name { 
  font-weight: bold; 
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.dark-theme .contact-info .name {
  color: #f0f0f0;
}

.contact-info .id { 
  font-size: 12px; 
  color: #666; 
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.dark-theme .contact-info .id {
  color: #aaa;
}

.badge {
  background: #ff4757; 
  color: #fff; 
  font-size: 11px; 
  padding: 2px 6px;
  border-radius: 10px; 
  position: absolute; 
  right: 10px; 
  top: 50%;
  transform: translateY(-50%);
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
  0% { transform: translateY(-50%) scale(1); }
  50% { transform: translateY(-50%) scale(1.1); }
  100% { transform: translateY(-50%) scale(1); }
}

/* Context Menu */
.context-menu {
  position: absolute;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  z-index: 1000;
  padding: 8px 0;
  width: 200px;
  animation: slideIn 0.2s ease;
}
@keyframes slideIn {
  from { opacity: 0; transform: translateY(-5px); }
  to { opacity: 1; transform: translateY(0); }
}
.dark-theme .context-menu {
  background: #3d3d3d;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.context-menu-item {
  padding: 8px 16px;
  cursor: pointer;
  font-size: 14px;
  transition: background-color 0.2s ease;
}
.context-menu-item:hover {
  background: #f0f0f0;
}
.dark-theme .context-menu-item:hover {
  background: #555;
}

/* Chat area */
.chat {
  flex: 1; 
  display: flex; 
  flex-direction: column;
}
.chat-header {
  padding: 15px; 
  border-bottom: 1px solid #ddd; 
  display: flex; 
  align-items: center;
  transition: background-color 0.3s ease;
}
.dark-theme .chat-header {
  border-color: #444;
  background: #2d2d2d;
}

.chat-header img {
  width: 40px; 
  height: 40px; 
  border-radius: 50%; 
  margin-right: 10px; 
  object-fit: cover;
}
.typing-indicator {
  display: flex;
  align-items: center;
  margin-left: 10px;
  font-size: 12px;
  color: #666;
}
.dark-theme .typing-indicator {
  color: #aaa;
}

.typing-dots {
  display: flex;
  margin-left: 5px;
}

.typing-dot {
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background-color: #666;
  margin: 0 1px;
  animation: typingAnimation 1.4s infinite ease-in-out;
}
.dark-theme .typing-dot {
  background-color: #aaa;
}

.typing-dot:nth-child(1) { animation-delay: 0s; }
.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingAnimation {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-5px); }
}

.chat-messages {
  flex: 1; 
  padding: 15px; 
  overflow-y: auto; 
  background: #fafafa;
  transition: background-color 0.3s ease;
}
.dark-theme .chat-messages {
  background: #222;
}

.msg {
  max-width: 70%; 
  padding: 12px 16px; 
  border-radius: 18px; 
  margin: 6px 0;
  word-wrap: break-word; 
  font-size: 15px;
  animation: msgAppear 0.3s ease;
  transition: transform 0.2s ease;
}
.msg:hover {
  transform: scale(1.01);
}
@keyframes msgAppear {
  from { opacity: 0; transform: translateY(10px) scale(0.95); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.me { 
  background: #0a84ff; 
  color: #fff; 
  margin-left: auto; 
  border-bottom-right-radius: 4px; 
}
.them { 
  background: #e0e0e0; 
  border-bottom-left-radius: 4px; 
}
.dark-theme .them {
  background: #3d3d3d;
  color: #f0f0f0;
}

.read-receipt {
  display: flex;
  justify-content: flex-end;
  margin-top: 2px;
  margin-bottom: 5px;
  align-items: center;
  font-size: 11px;
  color: rgba(0, 0, 0, 0.5);
  animation: fadeIn 0.5s ease;
}
.dark-theme .read-receipt {
  color: rgba(255, 255, 255, 0.5);
}

.read-receipt img {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  margin-left: 5px;
}

/* Input bar */
.chat-input {
  display: flex; 
  align-items: center; 
  padding: 10px; 
  border-top: 1px solid #ddd;
  background: #fff;
  position: relative;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}
.dark-theme .chat-input {
  background: #2d2d2d;
  border-color: #444;
}

.chat-input input[type="text"] {
  flex: 1; 
  padding: 12px 16px; 
  border-radius: 20px; 
  border: 1px solid #ccc;
  font-size: 14px; 
  outline: none; 
  font-family: 'Inter', sans-serif;
  transition: all 0.3s ease;
}
.dark-theme .chat-input input[type="text"] {
  background: #3d3d3d;
  border-color: #555;
  color: #f0f0f0;
}

.chat-input input[type="text"]:focus {
  border-color: #0a84ff;
  box-shadow: 0 0 0 2px rgba(10, 132, 255, 0.1);
}

.chat-input button {
  background: none; 
  border: none; 
  margin-left: 8px; 
  cursor: pointer;
  font-size: 20px; 
  padding: 8px; 
  border-radius: 50%;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
}
.chat-input button:hover { 
  background-color: #f0f0f0; 
  color: #0a84ff; 
  transform: scale(1.1);
}
.dark-theme .chat-input button:hover { 
  background-color: #444; 
}

/* Modals */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  animation: fadeIn 0.3s ease;
}

.modal-content {
  background: white;
  border-radius: 16px;
  padding: 25px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  animation: scaleIn 0.3s ease;
}
@keyframes scaleIn {
  from { transform: scale(0.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
.dark-theme .modal-content {
  background: #2d2d2d;
  color: #f0f0f0;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.modal-header h3 {
  margin: 0;
  font-size: 20px;
}

.modal-close {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #999;
  transition: color 0.2s ease;
}
.modal-close:hover {
  color: #333;
}
.dark-theme .modal-close:hover {
  color: #f0f0f0;
}

.modal-body {
  margin-bottom: 20px;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
}

.modal-input {
  width: 100%;
  padding: 12px 14px;
  margin-bottom: 15px;
  border: 1px solid #ddd;
  border-radius: 10px;
  font-size: 15px;
  font-family: 'Inter', sans-serif;
  transition: all 0.2s ease;
  outline: none;
}
.dark-theme .modal-input {
  background: #3d3d3d;
  border-color: #555;
  color: #f0f0f0;
}

.modal-input:focus {
  border-color: #0a84ff;
  box-shadow: 0 0 0 2px rgba(10, 132, 255, 0.1);
}

.modal-button {
  padding: 12px 20px;
  background: #0a84ff;
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  margin-left: 10px;
  font-weight: 500;
  transition: all 0.2s ease;
}
.modal-button:hover {
  background: #0077e6;
  transform: translateY(-2px);
}

/* Toast */
.toast {
  position: fixed; 
  bottom: 20px; 
  left: 50%; 
  transform: translateX(-50%) translateY(20px);
  background: rgba(0,0,0,0.85); 
  color: #fff; 
  padding: 12px 20px;
  border-radius: 12px; 
  opacity: 0; 
  pointer-events: none;
  transition: opacity 0.3s, transform 0.3s; 
  z-index: 999; 
  font-size: 14px;
}
.toast.show { 
  opacity: 1; 
  transform: translateX(-50%) translateY(0); 
}

/* Settings */
.settings-button {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: #666;
  margin-left: 10px;
  transition: color 0.2s ease, transform 0.2s ease;
}
.settings-button:hover {
  color: #0a84ff;
  transform: rotate(30deg);
}
.dark-theme .settings-button {
  color: #aaa;
}

.settings-panel {
  position: absolute;
  top: 50px;
  right: 10px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  padding: 15px;
  width: 200px;
  z-index: 100;
  animation: slideIn 0.2s ease;
}
.dark-theme .settings-panel {
  background: #3d3d3d;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.settings-option {
  padding: 10px 0;
  cursor: pointer;
  display: flex;
  align-items: center;
  transition: color 0.2s ease;
}
.settings-option:hover {
  color: #0a84ff;
}

.settings-option i {
  margin-right: 10px;
  width: 20px;
}

/* Voice Recorder */
.voice-recorder {
  position: absolute;
  bottom: 70px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.9);
  padding: 15px 20px;
  border-radius: 50px;
  display: flex;
  align-items: center;
  color: white;
  animation: slideUp 0.3s ease;
}
@keyframes slideUp {
  from { opacity: 0; transform: translateX(-50%) translateY(10px); }
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

.voice-recorder-timer {
  margin: 0 15px;
  font-weight: 500;
}

.voice-recorder-cancel {
  background: #ff4757;
  color: white;
  border: none;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s ease;
}
.voice-recorder-cancel:hover {
  background: #ff3742;
}

/* Image Preview */
.image-preview {
  position: absolute;
  bottom: 70px;
  left: 50%;
  transform: translateX(-50%);
  background: white;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  max-width: 250px;
  animation: slideUp 0.3s ease;
}
.dark-theme .image-preview {
  background: #3d3d3d;
}

.image-preview img {
  max-width: 100%;
  border-radius: 8px;
  margin-bottom: 10px;
}

.image-preview-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
}

.image-preview-button {
  padding: 8px 15px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s ease;
}

.image-preview-cancel {
  background: #ff4757;
  color: white;
}
.image-preview-cancel:hover {
  background: #ff3742;
  transform: translateY(-2px);
}

.image-preview-send {
  background: #0a84ff;
  color: white;
}
.image-preview-send:hover {
  background: #0077e6;
  transform: translateY(-2px);
}

/* Message status indicators */
.message-status {
  font-size: 11px;
  text-align: right;
  margin-top: 2px;
  color: rgba(255, 255, 255, 0.7);
  animation: fadeIn 0.5s ease;
}

.them .message-status {
  color: rgba(0, 0, 0, 0.5);
  text-align: left;
}
.dark-theme .them .message-status {
  color: rgba(255, 255, 255, 0.5);
}

/* Media messages */
.media-message {
  max-width: 250px;
  margin: 6px 0;
}

.media-message img {
  width: 100%;
  border-radius: 12px;
}

.audio-message {
  display: flex;
  align-items: center;
  padding: 10px;
  background: #f0f0f0;
  border-radius: 20px;
}
.dark-theme .audio-message {
  background: #3d3d3d;
}

.audio-message audio {
  flex: 1;
  height: 30px;
}

.audio-duration {
  margin-left: 10px;
  font-size: 12px;
  color: #666;
}
.dark-theme .audio-duration {
  color: #aaa;
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}
.dark-theme ::-webkit-scrollbar-track {
  background: #2d2d2d;
}

::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 10px;
}
.dark-theme ::-webkit-scrollbar-thumb {
  background: #555;
}

::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}
.dark-theme ::-webkit-scrollbar-thumb:hover {
  background: #666;
}

/* File input */
.hidden-input {
  display: none;
}

/* Loading animation */
.loading {
  display: flex;
  justify-content: center;
  padding: 20px;
}

.loading-dots {
  display: flex;
}

.loading-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: #0a84ff;
  margin: 0 4px;
  animation: loadingAnimation 1.4s infinite ease-in-out;
}

.loading-dot:nth-child(1) { animation-delay: 0s; }
.loading-dot:nth-child(2) { animation-delay: 0.2s; }
.loading-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes loadingAnimation {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-10px); }
}
</style>
</head>
<body>

<!-- Auth Screen -->
<div id="auth">
  <div class="auth-container">
    <div class="auth-header">
      <h2>Tajib Lite</h2>
      <p>Sign in to continue messaging</p>
    </div>
    
    <div id="loginForm">
      <div class="auth-form">
        <input id="loginEmail" type="email" placeholder="Email" />
        <input id="loginPassword" type="password" placeholder="Password" />
        <button id="loginBtn">Log In</button>
      </div>
      <div class="auth-toggle">
        <p>No account? <a href="#" id="showSignup">Sign up</a></p>
      </div>
    </div>
    
    <div id="signupForm" class="hidden">
      <div class="auth-form">
        <input id="signupEmail" type="email" placeholder="Email" />
        <input id="signupPassword" type="password" placeholder="Password" />
        <input id="signupCode" type="text" maxlength="10" placeholder="Number ID (10 digits)" />
        <input id="signupDisplayName" type="text" placeholder="Display Name" />
        <button id="signupBtn">Sign Up</button>
      </div>
      <div class="auth-toggle">
        <p>Have an account? <a href="#" id="showLogin">Log in</a></p>
      </div>
    </div>
  </div>
</div>

<!-- App Screen -->
<div id="app" class="hidden">
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>Contacts</h2>
      <div>
        <button id="settingsBtn" class="settings-button"><i class="fas fa-cog"></i></button>
        <button id="addContactBtn">+</button>
      </div>
    </div>
    <div class="contacts" id="contactsList"></div>
  </div>
  <div class="chat">
    <div class="chat-header" id="chatHeader">
      <img id="chatAvatar" src="" alt="" />
      <div style="flex: 1;">
        <div id="chatName"></div>
        <div id="chatNumberId" style="font-size:12px;color:#666;"></div>
      </div>
      <div id="typingIndicator" class="typing-indicator hidden">
        <span>typing</span>
        <div class="typing-dots">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      </div>
    </div>
    <div class="chat-messages" id="messages"></div>
    <div class="chat-input">
      <input id="messageText" type="text" placeholder="Type a message..." />
      <button id="voiceBtn"><i class="fas fa-microphone"></i></button>
      <button id="imageBtn"><i class="fas fa-image"></i></button>
      <button id="sendBtn"><i class="fas fa-paper-plane"></i></button>
      <input type="file" id="imageUpload" accept="image/*" class="hidden-input" />
      <input type="file" id="audioUpload" accept="audio/*" class="hidden-input" />
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<!-- Context Menu -->
<div id="contextMenu" class="context-menu hidden">
  <div class="context-menu-item" data-action="edit"><i class="fas fa-edit"></i> Edit Contact</div>
  <div class="context-menu-item" data-action="delete"><i class="fas fa-trash"></i> Delete Contact</div>
</div>

<!-- Add Contact Modal -->
<div id="addContactModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add New Contact</h3>
      <button class="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <input type="text" id="contactNumberId" class="modal-input" placeholder="Number ID (10 digits)" maxlength="10">
    </div>
    <div class="modal-footer">
      <button class="modal-button" id="addContactModalBtn">Add Contact</button>
    </div>
  </div>
</div>

<!-- Edit Contact Modal -->
<div id="editContactModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Edit Contact</h3>
      <button class="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <input type="text" id="editContactName" class="modal-input" placeholder="Contact Display Name">
      <input type="text" id="editContactAvatar" class="modal-input" placeholder="Avatar URL">
    </div>
    <div class="modal-footer">
      <button class="modal-button" id="saveContactBtn">Save Changes</button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Settings</h3>
      <button class="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <h4>Appearance</h4>
      <select id="themeSelect" class="modal-input">
        <option value="light">Light Theme</option>
        <option value="dark">Dark Theme</option>
      </select>
      
      <h4>Account Settings</h4>
      <input type="text" id="settingsDisplayName" class="modal-input" placeholder="Display Name">
      <input type="email" id="settingsEmail" class="modal-input" placeholder="Email">
      <input type="password" id="settingsPassword" class="modal-input" placeholder="New Password (leave empty to keep current)">
    </div>
    <div class="modal-footer">
      <button class="modal-button" id="saveSettingsBtn">Save Settings</button>
    </div>
  </div>
</div>

<!-- Voice Recorder -->
<div id="voiceRecorder" class="voice-recorder hidden">
  <i class="fas fa-microphone"></i>
  <div class="voice-recorder-timer">00:00</div>
  <button class="voice-recorder-cancel"><i class="fas fa-times"></i></button>
</div>

<!-- Image Preview -->
<div id="imagePreview" class="image-preview hidden">
  <img id="previewImage" src="" alt="Preview">
  <div class="image-preview-actions">
    <button class="image-preview-button image-preview-cancel">Cancel</button>
    <button class="image-preview-button image-preview-send">Send</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, updateEmail, updatePassword } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, addDoc, collection, query, where, orderBy, onSnapshot, serverTimestamp, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-storage.js";

/* ===== Firebase Config ===== */
const firebaseConfig = {
  apiKey: "AIzaSyBQebZVAnxwEySzQZf3S4EpTW1YCFUTiHs",
  authDomain: "tajibmessage.firebaseapp.com",
  projectId: "tajibmessage",
  storageBucket: "tajibmessage.firebasestorage.app",
  messagingSenderId: "74585771811",
  appId: "1:74585771811:web:c5d196f4ffd6acb8de4696",
  measurementId: "G-QQJT29P8PS"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

/* ===== State ===== */
let me = null;
let currentChat = null;
let unsubMessages = null;
let unsubNotifications = null;
let unsubTyping = null;
let contacts = [];
let selectedContact = null;
let mediaRecorder = null;
let audioChunks = [];
let recorderTimer = null;
let recorderSeconds = 0;
let contactsMap = new Map();

/* ===== DOM Elements ===== */
const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);

/* ===== Helpers ===== */
function toast(msg) {
  const t = $("#toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 2000);
}

function formatTime(seconds) {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

// Optimistically add message to UI
function addMessageToUI(message, isMe = false) {
  const box = $("#messages");
  const div = document.createElement("div");
  div.className = `msg ${isMe ? "me" : "them"}`;
  
  if (message.text) {
    div.textContent = message.text;
  } else if (message.imageUrl) {
    div.classList.add("media-message");
    div.innerHTML = `<img src="${message.imageUrl}" alt="Sent image">`;
  } else if (message.audioUrl) {
    div.classList.add("media-message");
    div.innerHTML = `
      <div class="audio-message">
        <audio controls src="${message.audioUrl}"></audio>
        <span class="audio-duration">${message.duration || ''}</span>
      </div>
    `;
  }
  
  div.dataset.tempId = message.tempId || '';
  
  // Add message status
  const statusDiv = document.createElement("div");
  statusDiv.className = "message-status";
  statusDiv.textContent = isMe ? "Sending..." : "";
  div.appendChild(statusDiv);
  
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
  
  // Animation
  setTimeout(() => {
    div.style.opacity = "1";
    div.style.transform = "translateY(0)";
  }, 10);
  
  return div;
}

// Update message status in UI
function updateMessageStatus(tempId, status) {
  const messageElement = $(`[data-temp-id="${tempId}"]`);
  if (messageElement) {
    const statusElement = messageElement.querySelector(".message-status");
    if (statusElement) {
      statusElement.textContent = status;
    }
  }
}

// Add read receipt to the last message
function addReadReceipt() {
  if (!currentChat) return;
  
  const box = $("#messages");
  const readReceipt = document.createElement("div");
  readReceipt.className = "read-receipt";
  readReceipt.innerHTML = `
    <span>Seen</span>
    <img src="${currentChat.avatar || 'https://via.placeholder.com/16'}" alt="${currentChat.name}">
  `;
  box.appendChild(readReceipt);
  box.scrollTop = box.scrollHeight;
}

/* ===== Auth UI Switch ===== */
$("#showSignup").onclick = (e) => { 
  e.preventDefault();
  $("#loginForm").classList.add("hidden"); 
  $("#signupForm").classList.remove("hidden"); 
};
$("#showLogin").onclick = (e) => { 
  e.preventDefault();
  $("#signupForm").classList.add("hidden"); 
  $("#loginForm").classList.remove("hidden"); 
};

/* ===== Auth State ===== */
onAuthStateChanged(auth, async user => {
  if (user) {
    const snap = await getDoc(doc(db, "users", user.uid));
    me = snap.exists() ? snap.data() : null;
    $("#auth").classList.add("hidden");
    $("#app").classList.remove("hidden");
    loadContacts();
    listenForNotifications();
    
    // Load theme preference
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.body.classList.toggle('dark-theme', savedTheme === 'dark');
    $("#themeSelect").value = savedTheme;
  } else {
    $("#auth").classList.remove("hidden");
    $("#app").classList.add("hidden");
    me = null;
    if (unsubMessages) unsubMessages();
    if (unsubNotifications) unsubNotifications();
    if (unsubTyping) unsubTyping();
  }
});

/* ===== Signup ===== */
$("#signupBtn").onclick = async () => {
  const email = $("#signupEmail").value.trim();
  const pwd = $("#signupPassword").value;
  const code = $("#signupCode").value.trim();
  const displayName = $("#signupDisplayName").value.trim();
  
  if (!email || !pwd || !code || !displayName) return toast("Fill all fields");
  if (code.length !== 10) return toast("Number ID must be 10 digits");
  
  try {
    const cred = await createUserWithEmailAndPassword(auth, email, pwd);
    await setDoc(doc(db, "users", cred.user.uid), {
      uid: cred.user.uid,
      email,
      numberId: code,
      name: displayName,
      avatar: ""
    });
    toast("Account created");
  } catch (e) {
    toast(e.message);
  }
};

/* ===== Login ===== */
$("#loginBtn").onclick = async () => {
  const email = $("#loginEmail").value.trim();
  const pwd = $("#loginPassword").value;
  if (!email || !pwd) return toast("Enter email and password");
  try {
    await signInWithEmailAndPassword(auth, email, pwd);
    toast("Logged in");
  } catch (e) {
    toast(e.message);
  }
};

/* ===== Logout ===== */
// Adding a logout button to the settings panel
const settingsPanel = document.createElement('div');
settingsPanel.className = 'settings-panel hidden';
settingsPanel.id = 'settingsPanel';
settingsPanel.innerHTML = `
  <div class="settings-option" id="settingsOption"><i class="fas fa-cog"></i> Settings</div>
  <div class="settings-option" id="themeOption"><i class="fas fa-moon"></i> Toggle Theme</div>
  <div class="settings-option" id="logoutOption"><i class="fas fa-sign-out-alt"></i> Logout</div>
`;
document.body.appendChild(settingsPanel);

$("#settingsBtn").addEventListener('click', (e) => {
  e.stopPropagation();
  const panel = $("#settingsPanel");
  panel.classList.toggle('hidden');
});

$("#logoutOption").addEventListener('click', async () => {
  await signOut(auth); 
  toast("Logged out");
  $("#settingsPanel").classList.add('hidden');
});

$("#themeOption").addEventListener('click', () => {
  const isDark = document.body.classList.toggle('dark-theme');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  $("#settingsPanel").classList.add('hidden');
  toast(isDark ? "Dark mode enabled" : "Light mode enabled");
});

$("#settingsOption").addEventListener('click', () => {
  $("#settingsModal").classList.remove('hidden');
  $("#settingsPanel").classList.add('hidden');
  $("#settingsEmail").value = me.email;
  $("#settingsDisplayName").value = me.name || "";
});

// Close settings panel when clicking outside
document.addEventListener('click', (e) => {
  if (!e.target.closest('.settings-button') && !e.target.closest('.settings-panel')) {
    $("#settingsPanel").classList.add('hidden');
  }
});

/* ===== Load Contacts ===== */
async function loadContacts() {
  const contactsRef = collection(db, "users", me.uid, "contacts");
  const snap = await getDocs(contactsRef);
  const list = $("#contactsList");
  list.innerHTML = "";
  contacts = [];
  contactsMap.clear();
  
  if (snap.empty) {
    list.innerHTML = `<div style="text-align: center; padding: 20px; color: #666;">No contacts yet. Click + to add one.</div>`;
    return;
  }
  
  snap.forEach(docSnap => {
    const contact = docSnap.data();
    contacts.push(contact);
    contactsMap.set(contact.uid, contact);
    
    const div = document.createElement("div");
    div.className = "contact";
    div.dataset.uid = contact.uid;
    div.innerHTML = `
      <img src="${contact.avatar || contact.originalAvatar || 'https://via.placeholder.com/40'}" />
      <div class="contact-info">
        <div class="name">${contact.name || contact.originalName || contact.email}</div>
        <div class="id">${contact.numberId}</div>
      </div>
    `;
    div.addEventListener('click', () => openChat(contact));
    div.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      selectedContact = contact;
      const contextMenu = $("#contextMenu");
      contextMenu.style.left = `${e.pageX}px`;
      contextMenu.style.top = `${e.pageY}px`;
      contextMenu.classList.remove('hidden');
    });
    list.appendChild(div);
  });
  
  // Close context menu when clicking elsewhere
  document.addEventListener('click', () => {
    $("#contextMenu").classList.add('hidden');
  });
}

// Context menu actions
$("#contextMenu").addEventListener('click', (e) => {
  const action = e.target.closest('.context-menu-item')?.dataset.action;
  if (action === 'edit') {
    $("#editContactModal").classList.remove('hidden');
    $("#editContactName").value = selectedContact.name || selectedContact.originalName || "";
    $("#editContactAvatar").value = selectedContact.avatar || selectedContact.originalAvatar || "";
  } else if (action === 'delete') {
    deleteContact(selectedContact.uid);
  }
});

// Delete contact
async function deleteContact(contactUid) {
  try {
    await deleteDoc(doc(db, "users", me.uid, "contacts", contactUid));
    toast("Contact deleted");
    loadContacts();
  } catch (error) {
    toast("Error deleting contact: " + error.message);
  }
}

/* ===== Add Contact Modal ===== */
$("#addContactBtn").addEventListener('click', () => {
  $("#addContactModal").classList.remove('hidden');
});

$("#addContactModalBtn").addEventListener('click', async () => {
  const numberId = $("#contactNumberId").value.trim();
  
  if (!numberId || numberId.length !== 10) {
    return toast("Number ID must be 10 digits");
  }
  
  // Check if user exists with this numberId
  const q = query(collection(db, "users"), where("numberId", "==", numberId));
  const querySnapshot = await getDocs(q);
  
  if (querySnapshot.empty) {
    return toast("No user found with this Number ID");
  }
  
  const contactUser = querySnapshot.docs[0].data();
  
  // Check if contact already exists
  const contactDoc = await getDoc(doc(db, "users", me.uid, "contacts", contactUser.uid));
  if (contactDoc.exists()) {
    return toast("Contact already exists");
  }
  
  // Add to user's contacts collection
  await setDoc(doc(db, "users", me.uid, "contacts", contactUser.uid), {
    uid: contactUser.uid,
    email: contactUser.email,
    numberId: contactUser.numberId,
    originalName: contactUser.name,
    originalAvatar: contactUser.avatar,
    name: contactUser.name, // Default to original name
    avatar: contactUser.avatar // Default to original avatar
  });
  
  toast("Contact added successfully");
  $("#addContactModal").classList.add('hidden');
  $("#contactNumberId").value = "";
  loadContacts();
});

/* ===== Save Contact Changes ===== */
$("#saveContactBtn").addEventListener('click', async () => {
  const name = $("#editContactName").value.trim();
  const avatar = $("#editContactAvatar").value.trim();
  
  // Update in user's contacts collection
  await setDoc(doc(db, "users", me.uid, "contacts", selectedContact.uid), {
    ...selectedContact,
    name: name || selectedContact.originalName,
    avatar: avatar || selectedContact.originalAvatar
  }, { merge: true });
  
  toast("Contact updated successfully");
  $("#editContactModal").classList.add('hidden');
  loadContacts();
});

/* ===== Save Settings ===== */
$("#saveSettingsBtn").addEventListener('click', async () => {
  const email = $("#settingsEmail").value.trim();
  const password = $("#settingsPassword").value;
  const displayName = $("#settingsDisplayName").value.trim();
  
  try {
    if (email !== me.email) {
      await updateEmail(auth.currentUser, email);
      await updateDoc(doc(db, "users", me.uid), { email });
      toast("Email updated successfully");
    }
    
    if (displayName && displayName !== me.name) {
      await updateDoc(doc(db, "users", me.uid), { name: displayName });
      toast("Display name updated successfully");
    }
    
    if (password) {
      await updatePassword(auth.currentUser, password);
      toast("Password updated successfully");
    }
    
    $("#settingsModal").classList.add('hidden');
    
    // Reload user data
    const snap = await getDoc(doc(db, "users", me.uid));
    me = snap.exists() ? snap.data() : null;
  } catch (error) {
    toast(error.message);
  }
});

// Theme selector change
$("#themeSelect").addEventListener('change', (e) => {
  const isDark = e.target.value === 'dark';
  document.body.classList.toggle('dark-theme', isDark);
  localStorage.setItem('theme', e.target.value);
});

/* ===== Close Modals ===== */
$$('.modal-close').forEach(btn => {
  btn.addEventListener('click', () => {
    btn.closest('.modal').classList.add('hidden');
  });
});

/* ===== Open Chat ===== */
function openChat(contact) {
  currentChat = contact;
  $("#chatAvatar").src = contact.avatar || contact.originalAvatar || "https://via.placeholder.com/40";
  $("#chatName").textContent = contact.name || contact.originalName || contact.email;
  $("#chatNumberId").textContent = contact.numberId;
  loadMessages();
  clearBadge(contact.uid);
  listenForTyping();
}

/* ===== Send Message ===== */
$("#sendBtn").onclick = sendMessage;

$("#messageText").addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    sendMessage();
  }
});

// Typing indicator
const updateTypingIndicator = debounce(async () => {
  if (!currentChat) return;
  
  // Set typing indicator in Firestore
  await setDoc(doc(db, "typing", me.uid), {
    userId: me.uid,
    chatWith: currentChat.uid,
    isTyping: false,
    timestamp: serverTimestamp()
  });
}, 1000);

$("#messageText").addEventListener("input", async () => {
  if (!currentChat) return;
  
  // Set typing indicator in Firestore
  await setDoc(doc(db, "typing", me.uid), {
    userId: me.uid,
    chatWith: currentChat.uid,
    isTyping: true,
    timestamp: serverTimestamp()
  });
  
  updateTypingIndicator();
});

async function sendMessage() {
  if (!currentChat) return toast("Select a contact first");
  const text = $("#messageText").value.trim();
  if (!text) return;
  
  // Clear typing indicator
  await setDoc(doc(db, "typing", me.uid), {
    userId: me.uid,
    chatWith: currentChat.uid,
    isTyping: false,
    timestamp: serverTimestamp()
  });
  
  // Generate a temporary ID for optimistic UI update
  const tempId = `temp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
  
  // Optimistically add message to UI
  addMessageToUI({
    text,
    tempId
  }, true);
  
  // Update status to sending
  updateMessageStatus(tempId, "Sending...");
  
  try {
    // Send to Firestore
    await addDoc(collection(db, "messages"), {
      senderId: me.uid,
      senderName: me.name || me.email,
      receiverId: currentChat.uid,
      receiverNumberId: currentChat.numberId,
      text,
      createdAt: serverTimestamp(),
      unread: true
    });
    
    // Update status to sent
    updateMessageStatus(tempId, "Sent");
    
    // After a short delay, update to delivered
    setTimeout(() => {
      updateMessageStatus(tempId, "Delivered");
    }, 1000);
    
    $("#messageText").value = "";
  } catch (error) {
    // Update status to failed
    updateMessageStatus(tempId, "Failed");
    toast("Failed to send message: " + error.message);
  }
}

/* ===== Load Messages ===== */
function loadMessages() {
  if (unsubMessages) unsubMessages();
  
  // Query for messages where I'm the sender or receiver with this specific contact
  const q = query(
    collection(db, "messages"),
    where("senderId", "in", [me.uid, currentChat.uid]),
    where("receiverId", "in", [me.uid, currentChat.uid]),
    orderBy("createdAt")
  );
  
  unsubMessages = onSnapshot(q, (snap) => {
    const box = $("#messages");
    box.innerHTML = "";
    
    snap.forEach(docSnap => {
      const m = docSnap.data();
      const mine = m.senderId === me.uid;
      
      let messageElement;
      
      if (m.text) {
        messageElement = addMessageToUI(m, mine);
      } else if (m.imageUrl) {
        messageElement = addMessageToUI(m, mine);
      } else if (m.audioUrl) {
        messageElement = addMessageToUI(m, mine);
      }
      
      // Add read status for my messages
      if (mine) {
        const statusElement = messageElement.querySelector(".message-status");
        if (statusElement) {
          statusElement.textContent = "Delivered";
          
          // Add read receipt if this is the last message
          if (docSnap === snap.docs[snap.docs.length - 1]) {
            addReadReceipt();
          }
        }
      }
    });
    
    box.scrollTop = box.scrollHeight;
  }, (error) => {
    console.error("Error loading messages:", error);
    toast("Error loading messages");
  });
}

/* ===== Listen for Typing ===== */
function listenForTyping() {
  if (unsubTyping) unsubTyping();
  
  const q = query(
    collection(db, "typing"),
    where("chatWith", "==", me.uid),
    where("userId", "==", currentChat.uid)
  );
  
  unsubTyping = onSnapshot(q, snap => {
    snap.forEach(docSnap => {
      const data = docSnap.data();
      const typingIndicator = $("#typingIndicator");
      
      if (data.isTyping) {
        typingIndicator.classList.remove("hidden");
      } else {
        typingIndicator.classList.add("hidden");
      }
    });
  });
}

/* ===== Voice Message ===== */
$("#voiceBtn").addEventListener('click', async () => {
  if (mediaRecorder && mediaRecorder.state === 'recording') {
    stopRecording();
    return;
  }
  
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];
    
    mediaRecorder.ondataavailable = (event) => {
      audioChunks.push(event.data);
    };
    
    mediaRecorder.onstop = async () => {
      const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
      const duration = recorderSeconds;
      
      // Upload to Firebase Storage
      const storageRef = ref(storage, `voice_messages/${Date.now()}.webm`);
      await uploadBytes(storageRef, audioBlob);
      const audioUrl = await getDownloadURL(storageRef);
      
      // Generate a temporary ID for optimistic UI update
      const tempId = `temp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      
      // Optimistically add message to UI
      addMessageToUI({
        audioUrl,
        duration: formatTime(duration),
        tempId
      }, true);
      
      // Send message with audio URL
      await addDoc(collection(db, "messages"), {
        senderId: me.uid,
        senderName: me.name || me.email,
        receiverId: currentChat.uid,
        receiverNumberId: currentChat.numberId,
        audioUrl,
        duration: formatTime(duration),
        createdAt: serverTimestamp(),
        unread: true
      });
      
      // Clean up
      stream.getTracks().forEach(track => track.stop());
      $("#voiceRecorder").classList.add('hidden');
      clearInterval(recorderTimer);
      recorderSeconds = 0;
    };
    
    mediaRecorder.start();
    $("#voiceRecorder").classList.remove('hidden');
    
    // Start timer
    recorderSeconds = 0;
    recorderTimer = setInterval(() => {
      recorderSeconds++;
      $(".voice-recorder-timer").textContent = formatTime(recorderSeconds);
    }, 1000);
    
  } catch (error) {
    toast("Error accessing microphone: " + error.message);
  }
});

function stopRecording() {
  if (mediaRecorder && mediaRecorder.state === 'recording') {
    mediaRecorder.stop();
  }
}

$(".voice-recorder-cancel").addEventListener('click', () => {
  if (mediaRecorder && mediaRecorder.state === 'recording') {
    mediaRecorder.stop();
    $("#voiceRecorder").classList.add('hidden');
    clearInterval(recorderTimer);
    recorderSeconds = 0;
  }
});

/* ===== Image Upload ===== */
$("#imageBtn").addEventListener('click', () => {
  $("#imageUpload").click();
});

$("#imageUpload").addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  
  if (!file.type.match('image.*')) {
    return toast("Please select an image file");
  }
  
  const reader = new FileReader();
  reader.onload = (e) => {
    $("#previewImage").src = e.target.result;
    $("#imagePreview").classList.remove('hidden');
  };
  reader.readAsDataURL(file);
});

$(".image-preview-cancel").addEventListener('click', () => {
  $("#imagePreview").classList.add('hidden');
  $("#imageUpload").value = '';
});

$(".image-preview-send").addEventListener('click', async () => {
  const file = $("#imageUpload").files[0];
  if (!file) return;
  
  // Generate a temporary ID for optimistic UI update
  const tempId = `temp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
  
  // Optimistically add message to UI
  addMessageToUI({
    imageUrl: $("#previewImage").src,
    tempId
  }, true);
  
  // Upload to Firebase Storage
  const storageRef = ref(storage, `images/${Date.now()}_${file.name}`);
  await uploadBytes(storageRef, file);
  const imageUrl = await getDownloadURL(storageRef);
  
  // Send message with image URL
  await addDoc(collection(db, "messages"), {
    senderId: me.uid,
    senderName: me.name || me.email,
    receiverId: currentChat.uid,
    receiverNumberId: currentChat.numberId,
    imageUrl,
    createdAt: serverTimestamp(),
    unread: true
  });
  
  $("#imagePreview").classList.add('hidden');
  $("#imageUpload").value = '';
});

/* ===== Notifications ===== */
function listenForNotifications() {
  const q = query(
    collection(db, "messages"),
    where("receiverId", "==", me.uid),
    where("unread", "==", true)
  );
  unsubNotifications = onSnapshot(q, snap => {
    snap.docChanges().forEach(change => {
      if (change.type === "added") {
        const m = change.doc.data();
        
        // Only show toast if not in current chat
        if (!currentChat || currentChat.uid !== m.senderId) {
          const contact = contactsMap.get(m.senderId);
          const contactName = contact ? (contact.name || contact.originalName) : m.senderName;
          toast(`${contactName} messaged you`);
          showBadge(m.senderId);
        } else {
          // If in current chat, mark as read immediately
          updateDoc(doc(db, "messages", change.doc.id), { unread: false });
        }
      }
    });
  });
}

function showBadge(uid) {
  const contactElement = $(`.contact[data-uid="${uid}"]`);
  if (contactElement && !contactElement.querySelector('.badge')) {
    const badge = document.createElement("div");
    badge.className = "badge";
    badge.textContent = "1";
    contactElement.appendChild(badge);
  }
}

function clearBadge(uid) {
  const contactElement = $(`.contact[data-uid="${uid}"]`);
  if (contactElement) {
    const badge = contactElement.querySelector('.badge');
    if (badge) badge.remove();
  }
  
  // Mark messages as read
  const q = query(
    collection(db, "messages"),
    where("senderId", "==", uid),
    where("receiverId", "==", me.uid),
    where("unread", "==", true)
  );
  getDocs(q).then(snap => {
    snap.forEach(docSnap => {
      updateDoc(doc(db, "messages", docSnap.id), { unread: false });
    });
  });
}

// Close modals when clicking outside
window.addEventListener('click', (e) => {
  if (e.target.classList.contains('modal')) {
    e.target.classList.add('hidden');
  }
});

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Check for saved theme
  const savedTheme = localStorage.getItem('theme') || 'light';
  if (savedTheme === 'dark') {
    document.body.classList.add('dark-theme');
  }
});
</script>
</body>
</html>
